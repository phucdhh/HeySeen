<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HeySeen - PDF to LaTeX Converter</title>
    <link href="tailwind.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 min-h-screen font-sans flex flex-col">
    <!-- Navigation Bar -->
    <nav class="bg-white shadow-sm border-b border-gray-200">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center space-x-3">
                    <i class="fa-solid fa-eye text-blue-600 text-2xl"></i>
                    <span class="text-xl font-bold text-gray-800">HeySeen</span>
                </div>
                
                <!-- Navigation Links -->
                <div class="hidden md:flex items-center space-x-6">
                    <a href="/" class="text-gray-700 hover:text-blue-600 transition font-medium">
                        <i class="fa-solid fa-home mr-1"></i>Home
                    </a>
                    <a href="https://github.com/phucdhh/HeySeen" target="_blank" class="text-gray-700 hover:text-blue-600 transition font-medium">
                        <i class="fa-brands fa-github mr-1"></i>GitHub
                    </a>
                    <a href="https://github.com/phucdhh/HeySeen/blob/main/TECHNICAL.md" target="_blank" class="text-gray-700 hover:text-blue-600 transition font-medium">
                        <i class="fa-solid fa-book mr-1"></i>Docs
                    </a>
                    
                    <!-- Dropdown for Related Apps -->
                    <div class="relative group">
                        <button class="text-gray-700 hover:text-blue-600 transition font-medium flex items-center">
                            <i class="fa-solid fa-grid-2 mr-1"></i>More Apps
                            <i class="fa-solid fa-chevron-down ml-1 text-xs"></i>
                        </button>
                        <div class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                            <a href="https://truyenthong.edu.vn/" target="_blank" class="block px-4 py-2 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition">
                                <i class="fa-solid fa-home-heart mr-2"></i>TruyenThong
                            </a>
                            <a href="https://heysym.truyenthong.edu.vn/" target="_blank" class="block px-4 py-2 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition">
                                <i class="fa-solid fa-square-root-variable mr-2"></i>HeySym
                            </a>
                            <a href="https://heytex.truyenthong.edu.vn/" target="_blank" class="block px-4 py-2 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition">
                                <i class="fa-solid fa-file-code mr-2"></i>HeyTeX
                            </a>
                            <a href="https://aithink.truyenthong.edu.vn/" target="_blank" class="block px-4 py-2 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition">
                                <i class="fa-solid fa-brain mr-2"></i>AIThink
                            </a>
                        </div>
                    </div>
                </div>
                
                <!-- Mobile Menu Button -->
                <button id="mobile-menu-btn" class="md:hidden text-gray-700">
                    <i class="fa-solid fa-bars text-xl"></i>
                </button>
            </div>
            
            <!-- Mobile Menu -->
            <div id="mobile-menu" class="hidden md:hidden py-4 border-t border-gray-200">
                <a href="/" class="block py-2 text-gray-700 hover:text-blue-600 transition">Home</a>
                <a href="https://github.com/phucdhh/HeySeen" target="_blank" class="block py-2 text-gray-700 hover:text-blue-600 transition">GitHub</a>
                <a href="https://github.com/phucdhh/HeySeen/blob/main/TECHNICAL.md" target="_blank" class="block py-2 text-gray-700 hover:text-blue-600 transition">Docs</a>
                <a href="https://heysym.truyenthong.edu.vn/" target="_blank" class="block py-2 text-gray-700 hover:text-blue-600 transition">HeySym</a>
                <a href="https://heytex.truyenthong.edu.vn/" target="_blank" class="block py-2 text-gray-700 hover:text-blue-600 transition">HeyTeX</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="flex-grow">
        <div class="container mx-auto px-4 py-8 max-w-3xl">
            <!-- Header -->
            <header class="mb-10 text-center">
                <h1 class="text-4xl font-bold text-gray-800 mb-2">
                    <i class="fa-solid fa-eye text-blue-600 mr-2"></i>HeySeen
                </h1>
                <p class="text-gray-600">Offline PDF to LaTeX Converter with AI-Powered Math Recognition</p>
                <div class="mt-3 flex justify-center items-center space-x-4 text-sm text-gray-500">
                    <span class="flex items-center">
                        <i class="fa-solid fa-lock mr-1"></i>100% Offline
                    </span>
                    <span class="flex items-center">
                        <i class="fa-brands fa-apple mr-1"></i>Apple Silicon
                    </span>
                    <span class="flex items-center">
                        <i class="fa-solid fa-code mr-1"></i>Open Source
                    </span>
                </div>
            </header>

        <!-- Upload Card -->
        <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
            <div id="drop-zone" class="border-2 border-dashed border-gray-300 rounded-lg p-12 text-center hover:border-blue-500 transition cursor-pointer bg-gray-50">
                <input type="file" id="file-input" class="hidden" accept=".pdf">
                <div class="text-gray-500">
                    <i class="fa-solid fa-cloud-arrow-up text-5xl mb-4 text-gray-400"></i>
                    <p class="text-lg font-medium">Click to upload or drag PDF here</p>
                    <p class="text-sm mt-2">Maximum file size: 50MB</p>
                </div>
            </div>

            <!-- Options -->
            <div class="mt-6 flex flex-col gap-3 justify-center">
                <label class="flex items-center space-x-2 cursor-pointer justify-center">
                    <input type="checkbox" id="math-ocr" checked class="form-checkbox h-5 w-5 text-blue-600 rounded">
                    <span class="text-gray-700">Enable Math AI (Texify)</span>
                </label>
                <label class="flex items-center space-x-2 cursor-pointer justify-center">
                    <input type="checkbox" id="use-llm" class="form-checkbox h-5 w-5 text-blue-600 rounded">
                    <span class="text-gray-700">Enable LLM Post-Processing <span class="text-sm text-orange-600">(+25s/page)</span></span>
                </label>
            </div>

            <div class="mt-6 text-center">
                <button id="convert-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed">
                    Convert to LaTeX
                </button>
            </div>
        </div>

        <!-- Progress Status -->
        <div id="status-card" class="hidden bg-white rounded-xl shadow-lg p-6 mb-8 border-l-4 border-blue-500">
            <h3 class="text-lg font-semibold text-gray-800 mb-2">Processing Status</h3>
            <div class="w-full bg-gray-200 rounded-full h-4 mb-2">
                <div id="progress-bar" class="bg-blue-600 h-4 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
            <p id="status-text" class="text-gray-600 text-sm font-mono">Initializing...</p>
        </div>

        <!-- Result Card -->
        <div id="result-card" class="hidden bg-green-50 rounded-xl shadow border border-green-200 p-8 text-center">
            <div class="mb-4">
                <i class="fa-solid fa-check-circle text-5xl text-green-500"></i>
            </div>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">Conversion Complete!</h2>
            <p class="text-gray-600 mb-6">Your LaTeX files are ready to download.</p>
            <a id="download-link" href="#" class="inline-block bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg shadow transition">
                <i class="fa-solid fa-download mr-2"></i>Download ZIP
            </a>
            <div class="mt-4">
                 <button onclick="location.reload()" class="text-gray-500 underline text-sm hover:text-gray-700">Convert Another File</button>
            </div>
        </div>
        
        <!-- Error Card -->
        <div id="error-card" class="hidden bg-red-50 rounded-xl shadow border border-red-200 p-6 text-center">
            <i class="fa-solid fa-circle-exclamation text-3xl text-red-500 mb-2"></i>
            <h3 class="text-lg font-bold text-red-800">Error</h3>
            <p id="error-text" class="text-red-600 text-sm"></p>
            <button onclick="location.reload()" class="mt-4 text-red-700 underline text-sm">Try Again</button>
        </div>
    </div>

    <!-- Script -->
    <script>
        // Use relative path so it works both locally (if proxied) and via Cloudflare Tunnel
        // Tunnel maps /convert, /status, /download to 5555, and root to 5556
        const API_URL = ""; 
        
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const convertBtn = document.getElementById('convert-btn');
        const statusCard = document.getElementById('status-card');
        const progressBar = document.getElementById('progress-bar');
        const statusText = document.getElementById('status-text');
        const resultCard = document.getElementById('result-card');
        const errorCard = document.getElementById('error-card');
        const downloadLink = document.getElementById('download-link');
        const errorText = document.getElementById('error-text');

        let selectedFile = null;

        // Make API URL dynamic based on current host if serving from same domain
        // const API_URL = window.location.origin.replace(":5556", ":5555"); // Poor man's discovery

        dropZone.addEventListener('click', () => fileInput.click());

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('border-blue-500', 'bg-blue-50');
        });

        dropZone.addEventListener('dragleave', () => {
             dropZone.classList.remove('border-blue-500', 'bg-blue-50');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('border-blue-500', 'bg-blue-50');
            if (e.dataTransfer.files.length) {
                handleFile(e.dataTransfer.files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length) {
                handleFile(e.target.files[0]);
            }
        });

        function handleFile(file) {
            if (file.type !== 'application/pdf') {
                alert('Please upload a PDF file.');
                return;
            }
            selectedFile = file;
            dropZone.innerHTML = `
                <i class="fa-solid fa-file-pdf text-4xl text-red-500 mb-2"></i>
                <p class="font-bold text-gray-800">${file.name}</p>
                <p class="text-sm text-gray-500">${(file.size / 1024 / 1024).toFixed(2)} MB</p>
                <p class="text-xs text-blue-500 mt-2">Click to change</p>
            `;
        }

        convertBtn.addEventListener('click', async () => {
            if (!selectedFile) {
                alert('Please select a file first.');
                return;
            }

            const useMath = document.getElementById('math-ocr').checked;
            const useLLM = document.getElementById('use-llm').checked;
            
            // UI Update
            convertBtn.disabled = true;
            convertBtn.classList.add('opacity-50', 'cursor-not-allowed');
            statusCard.classList.remove('hidden');
            resultCard.classList.add('hidden');
            errorCard.classList.add('hidden');

            const formData = new FormData();
            formData.append('file', selectedFile);

            try {
                // 1. Create Job
                const response = await fetch(`${API_URL}/convert?math_ocr=${useMath}&use_llm=${useLLM}`, {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) throw new Error('Upload failed');
                
                const job = await response.json();
                const jobId = job.job_id;
                
                pollStatus(jobId);

            } catch (error) {
                showError(error.message);
            }
        });

        async function pollStatus(jobId) {
            const interval = setInterval(async () => {
                try {
                    const res = await fetch(`${API_URL}/status/${jobId}`);
                    const data = await res.json();
                    
                    // Update UI
                    const percentage = Math.round(data.progress * 100);
                    progressBar.style.width = `${percentage}%`;
                    statusText.textContent = `${data.message} (${percentage}%)`;
                    
                    if (data.status === 'completed') {
                        clearInterval(interval);
                        showResult(jobId);
                    } else if (data.status === 'failed') {
                        clearInterval(interval);
                        showError(data.message);
                    }
                    
                } catch (e) {
                    clearInterval(interval);
                    showError("Connection lost");
                }
            }, 1000);
        }

        function showResult(jobId) {
            statusCard.classList.add('hidden');
            resultCard.classList.remove('hidden');
            downloadLink.href = `${API_URL}/download/${jobId}`;
        }

        function showError(msg) {
            statusCard.classList.add('hidden');
            errorCard.classList.remove('hidden');
            errorText.textContent = msg;
            convertBtn.disabled = false;
            convertBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        }
        
        // Mobile menu toggle
        document.getElementById('mobile-menu-btn').addEventListener('click', () => {
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenu.classList.toggle('hidden');
        });
    </script>
    
    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-auto">
        <div class="container mx-auto px-4 py-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-6">
                <!-- About -->
                <div>
                    <h3 class="font-bold text-gray-800 mb-3 flex items-center">
                        <i class="fa-solid fa-eye text-blue-600 mr-2"></i>HeySeen
                    </h3>
                    <p class="text-gray-600 text-sm leading-relaxed">
                        Offline-first PDF to LaTeX converter optimized for Apple Silicon. 
                        Convert academic papers, textbooks, and documents without cloud dependency.
                    </p>
                </div>
                
                <!-- Quick Links -->
                <div>
                    <h3 class="font-bold text-gray-800 mb-3">Quick Links</h3>
                    <ul class="space-y-2 text-sm">
                        <li>
                            <a href="https://github.com/phucdhh/HeySeen" target="_blank" class="text-gray-600 hover:text-blue-600 transition">
                                <i class="fa-brands fa-github mr-1"></i>GitHub Repository
                            </a>
                        </li>
                        <li>
                            <a href="https://github.com/phucdhh/HeySeen/blob/main/README.md" target="_blank" class="text-gray-600 hover:text-blue-600 transition">
                                <i class="fa-solid fa-book-open mr-1"></i>Documentation
                            </a>
                        </li>
                        <li>
                            <a href="https://github.com/phucdhh/HeySeen/blob/main/TECHNICAL.md" target="_blank" class="text-gray-600 hover:text-blue-600 transition">
                                <i class="fa-solid fa-code mr-1"></i>Technical Guide
                            </a>
                        </li>
                        <li>
                            <a href="https://github.com/phucdhh/HeySeen/issues" target="_blank" class="text-gray-600 hover:text-blue-600 transition">
                                <i class="fa-solid fa-bug mr-1"></i>Report Issues
                            </a>
                        </li>
                    </ul>
                </div>
                
                <!-- Related Projects -->
                <div>
                    <h3 class="font-bold text-gray-800 mb-3">Related Projects</h3>
                    <ul class="space-y-2 text-sm">
                        <li>
                            <a href="https://truyenthong.edu.vn/" target="_blank" class="text-gray-600 hover:text-blue-600 transition">
                                <i class="fa-solid fa-home-heart mr-1"></i>TruyenThong Platform
                            </a>
                        </li>
                        <li>
                            <a href="https://heysym.truyenthong.edu.vn/" target="_blank" class="text-gray-600 hover:text-blue-600 transition">
                                <i class="fa-solid fa-square-root-variable mr-1"></i>HeySym (Math Learning)
                            </a>
                        </li>
                        <li>
                            <a href="https://heytex.truyenthong.edu.vn/" target="_blank" class="text-gray-600 hover:text-blue-600 transition">
                                <i class="fa-solid fa-file-code mr-1"></i>HeyTeX (LaTeX Editor)
                            </a>
                        </li>
                        <li>
                            <a href="https://aithink.truyenthong.edu.vn/" target="_blank" class="text-gray-600 hover:text-blue-600 transition">
                                <i class="fa-solid fa-brain mr-1"></i>AIThink (AI Assistant)
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            
            <!-- Bottom Bar -->
            <div class="border-t border-gray-200 pt-6 flex flex-col md:flex-row justify-between items-center text-sm text-gray-600">
                <div class="mb-4 md:mb-0">
                    <p>© 2026 <a href="https://truyenthong.edu.vn/" target="_blank" class="text-blue-600 hover:underline">truyenthong.edu.vn</a> | Built with ❤️ for education</p>
                </div>
                <div class="flex items-center space-x-4">
                    <span>Developed by <a href="https://github.com/phucdhh" target="_blank" class="text-blue-600 hover:underline font-medium">Nguyễn Đăng Minh Phúc</a></span>
                    <a href="https://github.com/phucdhh/HeySeen" target="_blank" class="text-gray-500 hover:text-gray-700 transition">
                        <i class="fa-brands fa-github text-xl"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>
</body>
</html>
